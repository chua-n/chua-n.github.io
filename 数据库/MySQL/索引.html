<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.59" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://chua-n.com/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E7%B4%A2%E5%BC%95.html"><meta property="og:site_name" content="荒流的笔趣屋"><meta property="og:title" content="索引"><meta property="og:description" content="1. 主键-外键 1.1 主键 对于关系表，有个很重要的约束，就是每条记录必须有一个唯一性标识，即通过某个字段可以区分出不同的记录，这个字段即被称为主键（primary key） 。 选取主键的一个基本原则是：不使用任何业务相关的字段作为主键。因此，身份证号、手机号、邮箱地址这些看上去可以唯一的字段，均不可用作主键。 如果我们以学生的身份证号作为主键，..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-05-06T10:03:53.000Z"><meta property="article:modified_time" content="2024-05-06T10:03:53.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"索引","image":[""],"dateModified":"2024-05-06T10:03:53.000Z","author":[{"@type":"Person","name":"荒流","url":"https://chua-n.com","email":"chua_n@qq.com"}]}</script><script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?d41714388d97166c965a387883f8c5e0";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
      </script><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/logo-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/logo-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/logo-apple-152.png" type="image/png" sizes="152x152"><link rel="icon" href="/assets/icon/logo-32.png" type="image/png" sizes="32x32"><link rel="icon" href="/assets/icon/logo-16.png" type="image/png" sizes="16x16"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#6a005f"><link rel="apple-touch-icon" href="/assets/icon/logo-apple-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/logo-ms-144.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="alternate" type="application/atom+xml" href="https://chua-n.com/atom.xml" title="荒流的笔趣屋 Atom Feed"><link rel="alternate" type="application/json" href="https://chua-n.com/feed.json" title="荒流的笔趣屋 JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://chua-n.com/rss.xml" title="荒流的笔趣屋 RSS Feed"><link rel="icon" href="https://figure-bed.chua-n.com/logo/川.ico"><title>索引 | 荒流的笔趣屋</title><meta name="description" content="1. 主键-外键 1.1 主键 对于关系表，有个很重要的约束，就是每条记录必须有一个唯一性标识，即通过某个字段可以区分出不同的记录，这个字段即被称为主键（primary key） 。 选取主键的一个基本原则是：不使用任何业务相关的字段作为主键。因此，身份证号、手机号、邮箱地址这些看上去可以唯一的字段，均不可用作主键。 如果我们以学生的身份证号作为主键，...">
    <link rel="stylesheet" href="/assets/css/styles.27bf87a0.css">
    <link rel="preload" href="/assets/js/runtime~app.59330dc2.js" as="script"><link rel="preload" href="/assets/css/styles.27bf87a0.css" as="style"><link rel="preload" href="/assets/js/48912.3c1ac731.js" as="script"><link rel="preload" href="/assets/js/app.906eea05.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/" aria-label="带我回家"><img class="vp-nav-logo" src="https://figure-bed.chua-n.com/logo/荒流.png" alt><!----><span class="vp-site-name hide-in-pad">荒流的笔趣屋</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog/" aria-label="随笔"><!--[--><span class="font-icon icon iconfont icon-leaf" style=""></span><!--]-->随笔<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Java"><!--[--><span class="font-icon icon iconfont icon-java" style=""></span>Java<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/Java/" aria-label="Java"><!--[--><span class="font-icon icon iconfont icon-java" style=""></span><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/JavaWeb/" aria-label="JavaWeb"><!--[--><span class="font-icon icon iconfont icon-web" style=""></span><!--]-->JavaWeb<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/JavaScript/" aria-label="JavaScript"><!--[--><span class="font-icon icon iconfont icon-javascript" style=""></span><!--]-->JavaScript<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/Python/" aria-label="Python"><!--[--><span class="font-icon icon iconfont icon-python" style=""></span><!--]-->Python<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/" aria-label="数据库"><!--[--><span class="font-icon icon iconfont icon-database" style=""></span><!--]-->数据库<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/Linux/" aria-label="Linux"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span><!--]-->Linux<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" aria-label="计算机网络"><!--[--><span class="font-icon icon iconfont icon-computer-network" style=""></span><!--]-->计算机网络<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/DSA/" aria-label="DSA"><!--[--><span class="font-icon icon iconfont icon-algorithm" style=""></span><!--]-->DSA<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E6%95%B0%E5%AD%A6/" aria-label="数学"><!--[--><span class="font-icon icon iconfont icon-math-pi" style=""></span><!--]-->数学<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/CV/" aria-label="CV"><!--[--><span class="font-icon icon iconfont icon-computer-vision-simple" style=""></span><!--]-->CV<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E6%9D%82%E6%8A%80/" aria-label="杂技"><!--[--><span class="font-icon icon iconfont icon-other-tech" style=""></span><!--]-->杂技<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/chua-n/chua-n.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><!--[--><button type="button" class="search-pro-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">/</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E8%AE%BA.html" aria-label="数据库概论"><!--[--><span class="font-icon icon iconfont icon-markdown-black" style=""></span><!--]-->数据库概论<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon iconfont icon-mysql" style=""></span><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%E5%8F%8A%E7%BB%B4%E6%8A%A4.html" aria-label="安装使用及维护"><!--[--><span class="font-icon icon iconfont icon-markdown-black" style=""></span><!--]-->安装使用及维护<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/schema.html" aria-label="schema"><!--[--><span class="font-icon icon iconfont icon-markdown-black" style=""></span><!--]-->schema<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/SQL%E8%AF%AD%E6%B3%95.html" aria-label="SQL语法"><!--[--><span class="font-icon icon iconfont icon-markdown-black" style=""></span><!--]-->SQL语法<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/SQL%E8%AF%AD%E8%A8%80.html" aria-label="SQL语言"><!--[--><span class="font-icon icon iconfont icon-markdown-black" style=""></span><!--]-->SQL语言<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E7%B4%A2%E5%BC%95.html" aria-label="索引"><!--[--><span class="font-icon icon iconfont icon-markdown-black" style=""></span><!--]-->索引<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E4%BA%8B%E5%8A%A1.html" aria-label="事务"><!--[--><span class="font-icon icon iconfont icon-markdown-black" style=""></span><!--]-->事务<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E5%85%A8%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2.html" aria-label="全文本搜索"><!--[--><span class="font-icon icon iconfont icon-markdown-black" style=""></span><!--]-->全文本搜索<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E8%A7%86%E5%9B%BE.html" aria-label="视图"><!--[--><span class="font-icon icon iconfont icon-markdown-black" style=""></span><!--]-->视图<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E3%80%81%E6%B8%B8%E6%A0%87%E3%80%81%E8%A7%A6%E5%8F%91%E5%99%A8.html" aria-label="存储过程、游标、触发器"><!--[--><span class="font-icon icon iconfont icon-markdown-black" style=""></span><!--]-->存储过程、游标、触发器<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E8%B0%83%E4%BC%98.html" aria-label="MySQL调优"><!--[--><span class="font-icon icon iconfont icon-markdown-black" style=""></span><!--]-->MySQL调优<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-mongodb" style=""></span><span class="vp-sidebar-title">mongoDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-redis" style=""></span><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-elasticsearch" style=""></span><span class="vp-sidebar-title">Elasticsearch</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->索引</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://chua-n.com" target="_blank" rel="noopener noreferrer">荒流</a></span><span property="author" content="荒流"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2024年1月21日</span><meta property="datePublished" content="2024-01-21T14:46:40.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 19 分钟</span><meta property="timeRequired" content="PT19M"></span><span class="page-word-info" aria-label="字数🔠" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 5758 字</span><meta property="wordCount" content="5758"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc" vp-toc><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-主键-外键">1. 主键-外键</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1-主键">1.1 主键</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-联合主键">1.2 联合主键</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-3-外键">1.3 外键</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_1-3-1-概念说明">1.3.1 概念说明</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_1-3-2-逻辑实现">1.3.2 逻辑实现</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-索引">2. 索引</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-1-概念引入">2.1 概念引入</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-索引的特性">2.2 索引的特性</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-3-索引的类型">2.3 索引的类型</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_2-3-1-b-tree-索引">2.3.1 B-tree 索引</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_2-3-2-全文索引">2.3.2 全文索引</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-4-高性能的索引策略">2.4 高性能的索引策略</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_2-4-1-前缀索引和索引的选择性">2.4.1 前缀索引和索引的选择性</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_2-4-2-多列索引">2.4.2 多列索引</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_2-4-3-聚簇索引">2.4.3 聚簇索引</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_2-4-4-覆盖索引">2.4.4 覆盖索引</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_2-4-5-使用索引扫描来做排序">2.4.5 使用索引扫描来做排序</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_2-4-6-避免重复和冗余索引">2.4.6 避免重复和冗余索引</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-5-维护索引和表">2.5 维护索引和表</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-6-唯一性索引-vs-唯一性约束">2.6 唯一性索引 vs 唯一性约束</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-约束">3. 约束</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><h2 id="_1-主键-外键" tabindex="-1"><a class="header-anchor" href="#_1-主键-外键"><span>1. 主键-外键</span></a></h2><h3 id="_1-1-主键" tabindex="-1"><a class="header-anchor" href="#_1-1-主键"><span>1.1 主键</span></a></h3><p>对于关系表，有个很重要的约束，就是每条记录必须有一个<strong>唯一性标识</strong>，即通过某个字段可以区分出不同的记录，这个字段即被称为<strong>主键（primary key）</strong> 。</p><ol><li><p>选取主键的一个基本原则是：<em>不使用任何业务相关的字段作为主键</em>。因此，身份证号、手机号、邮箱地址这些看上去可以唯一的字段，均不可用作主键。</p><blockquote><p>如果我们以学生的身份证号作为主键，似乎能唯一定位记录，然而，身份证号也是一种业务场景，如果身份证号升位了，或者需要变更，作为主键，不得不修改的时候，就会对业务产生严重影响。</p></blockquote></li><li><p>主键值也不能为<code>NULL</code>。</p></li><li><p>一般我们把主键这个字段命名为<code>id</code>，常见的可作为<code>id</code>字段的类型有：</p><ul><li>自增<strong>整数</strong>类型：数据库会在插入数据时自动为每一条记录分配一个自增整数，这样我们就完全不用担心主键重复，也不用自己预先生成主键；</li><li><strong>GUID</strong> 类型：使用一种全局唯一的字符串作为主键，类似<code>8f55d96b-8acc-4636-8cb8-76bf8abc2f57</code>。GUID 算法通过网卡 MAC 地址、时间戳和随机数保证任意计算机在任意时间生成的字符串都是不同的，大部分编程语言都内置了 GUID 算法，可以自己预算出主键。</li></ul></li></ol><h3 id="_1-2-联合主键" tabindex="-1"><a class="header-anchor" href="#_1-2-联合主键"><span>1.2 联合主键</span></a></h3><p>关系数据库实际上还允许通过多个字段唯一标识记录，即将两个或更多的字段都设置为主键，这种主键被称为<strong>联合主键</strong>。</p><p>显然，对于联合主键，允许一列有重复，只要不是所有主键列都重复即可：</p><table><thead><tr><th style="text-align:center;">id_num</th><th style="text-align:center;">id_type</th><th style="text-align:center;">other columns</th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">A</td><td style="text-align:center;">...</td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">A</td><td style="text-align:center;">...</td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">B</td><td style="text-align:center;">...</td></tr></tbody></table><blockquote><ol><li>如果我们把上述表的<code>id_num</code>和<code>id_type</code>这两列作为联合主键，那么上面的 3 条记录都是允许的，因为没有两列主键组合起来是相同的。</li><li>没有必要的情况下，我们尽量不使用联合主键，因为它给关系表带来了复杂度的上升。</li></ol></blockquote><h3 id="_1-3-外键" tabindex="-1"><a class="header-anchor" href="#_1-3-外键"><span>1.3 外键</span></a></h3><h4 id="_1-3-1-概念说明" tabindex="-1"><a class="header-anchor" href="#_1-3-1-概念说明"><span>1.3.1 概念说明</span></a></h4><p><strong>外键</strong>是某个表中的一列，它包含另一个表的主键值，定义了两个表的关系。</p><p>如，当我们用主键唯一标识记录时，我们就可以在<code>students</code>表中确定任意一个学生的记录：</p><table><thead><tr><th style="text-align:center;">id</th><th style="text-align:center;">name</th><th style="text-align:center;">other columns</th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">小明</td><td style="text-align:center;">...</td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">小红</td><td style="text-align:center;">...</td></tr></tbody></table><p>我们还可以在<code>classes</code>表中确定任意一个班级记录：</p><table><thead><tr><th style="text-align:center;">id</th><th style="text-align:center;">name</th><th style="text-align:center;">other columns</th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">一班</td><td style="text-align:center;">...</td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">二班</td><td style="text-align:center;">...</td></tr></tbody></table><p>但是我们如何确定<code>students</code>表的一条记录，例如，<code>id=1</code>的小明，属于哪个班级呢？由于一个班级可以有多个学生，在关系模型中，这两个表的关系可以称为“一对多”，即一个<code>classes</code>的记录可以对应多个<code>students</code>表的记录。为了表达这种一对多的关系，我们需要在<code>students</code>表中加入一列<code>class_id</code>，让它的值与<code>classes</code>表的某条记录相对应，这样，我们就可以根据<code>class_id</code>这个列直接定位出一个<code>students</code>表的记录应该对应到<code>classes</code>的哪条记录。</p><table><thead><tr><th>id</th><th>class_id</th><th>name</th><th>other columns</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>小明</td><td>...</td></tr><tr><td>2</td><td>1</td><td>小红</td><td>...</td></tr><tr><td>5</td><td>2</td><td>小白</td><td>...</td></tr></tbody></table><p>在<code>students</code>表中，通过<code>class_id</code>的字段，可以把数据与另一张表关联起来，这种列称为外键。</p><h4 id="_1-3-2-逻辑实现" tabindex="-1"><a class="header-anchor" href="#_1-3-2-逻辑实现"><span>1.3.2 逻辑实现</span></a></h4><p>外键并不是通过列名实现的，而是通过定义<strong>外键约束</strong>实现的：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> students</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ADD</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> CONSTRAINT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> fk_class_id</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FOREIGN KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (class_id)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">REFERENCES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> classes (id);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>其中，外键约束的名称<code>fk_class_id</code>可以任意，<code>FOREIGN KEY (class_id)</code>指定了<code>class_id</code>作为外键，<code>REFERENCES classes (id)</code>指定了这个外键将关联到<code>classes</code>表的<code>id</code>列（即<code>classes</code>表的主键）</p></blockquote><p>通过定义外键约束，关系数据库可以保证无法插入无效的数据。即如果<code>classes</code>表不存在<code>id=99</code>的记录，<code>students</code>表就无法插入<code>class_id=99</code>的记录。</p><p>由于外键约束会降低数据库的性能，大部分互联网应用程序为了追求速度，并不设置外键约束，而是仅靠应用程序自身来保证逻辑的正确性。这种情况下，<code>class_id</code>仅仅是一个普通的列，只是它起到了外键的作用而已。</p><p>要删除一个外键约束，也是通过<code>ALTER TABLE</code>实现的：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> students</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FOREIGN KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> fk_class_id;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意：删除外键约束并没有删除外键这一列。删除列是通过<code>DROP COLUMN ...</code>实现的 。</p></blockquote><h2 id="_2-索引" tabindex="-1"><a class="header-anchor" href="#_2-索引"><span>2. 索引</span></a></h2><h3 id="_2-1-概念引入" tabindex="-1"><a class="header-anchor" href="#_2-1-概念引入"><span>2.1 概念引入</span></a></h3><p><strong>索引</strong>是关系数据库中对某一列或多个列的值进行预排序的数据结构。在关系数据库中，如果有上万甚至上亿条记录，在查找记录的时候，想要获得非常快的速度，就需要使用索引。索引在 MySQL 中也叫作<strong>键（key）</strong>。</p><p>通过使用索引，可以让数据库系统不必扫描整个表，而是直接定位到符合条件的记录，这样就大大加快了查询速度。例如，对于<code>students</code>表：</p><table><thead><tr><th style="text-align:center;">id</th><th style="text-align:center;">class_id</th><th style="text-align:center;">name</th><th style="text-align:center;">gender</th><th style="text-align:center;">score</th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">1</td><td style="text-align:center;">小明</td><td style="text-align:center;">M</td><td style="text-align:center;">90</td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">1</td><td style="text-align:center;">小红</td><td style="text-align:center;">F</td><td style="text-align:center;">95</td></tr><tr><td style="text-align:center;">3</td><td style="text-align:center;">1</td><td style="text-align:center;">小军</td><td style="text-align:center;">M</td><td style="text-align:center;">88</td></tr></tbody></table><p>如果要经常根据<code>score</code>列进行查询，就可以对<code>score</code>列创建索引：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> students</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ADD</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> idx_score (score);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>使用<code>ADD INDEX idx_score (score)</code>就创建了一个名称为<code>idx_score</code>、使用列<code>score</code>的索引。</p></li><li><p>可以对一张表创建多个索引，其中索引名称是任意的，索引如果有多列，可以在括号里依次写上，例如：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> students</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ADD</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> idx_name_score (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, score);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_2-2-索引的特性" tabindex="-1"><a class="header-anchor" href="#_2-2-索引的特性"><span>2.2 索引的特性</span></a></h3><p>索引的优点是提高了查询效率，缺点是在插入、更新和删除记录时，需要同时修改索引，因此，索引越多，插入、更新和删除记录的速度就越慢。</p><p>索引提高查询效率的原因：</p><ul><li>大大减少了服务器需要扫描的数据量。</li><li>帮助服务器避免排序和临时表。</li><li>将随机 I/O 变成了顺序 I/O。</li></ul><p><strong>索引的效率取决于索引列的值是否散列</strong>：</p><ul><li>该列的值如果越互不相同，那么索引效率越高。</li><li>反过来，如果记录的列存在大量相同的值，例如<code>gender</code>列，大约一半的记录值是<code>M</code>，另一半是<code>F</code>，因此，对该列创建索引就没有意义。</li></ul><p>对于主键，关系数据库会自动对其创建主键索引。使用主键索引的效率是最高的，因为主键会保证绝对唯一。</p><p>无论是否创建索引，对于用户和应用程序来说，使用关系数据库不会有任何区别。这里的意思是说，当我们在数据库中查询时，如果有相应的索引可用，数据库系统就会自动使用索引来提高查询效率，如果没有索引，查询也能正常执行，只是速度会变慢。因此，索引可以在使用数据库的过程中逐步优化。</p><h3 id="_2-3-索引的类型" tabindex="-1"><a class="header-anchor" href="#_2-3-索引的类型"><span>2.3 索引的类型</span></a></h3><p>在 MySQL 中，索引是在<em>存储引擎层</em>而不是服务器层实现的，所以，并没有统一的索引标准。</p><h4 id="_2-3-1-b-tree-索引" tabindex="-1"><a class="header-anchor" href="#_2-3-1-b-tree-索引"><span>2.3.1 B-tree 索引</span></a></h4><p>当人们谈论索引的时候，如果没有特别指定类型，那么多半说的是 B-tree 索引，它使用 B-tree 数据结构来存储数据（实际上，很多存储引擎实际使用的是 B+ tree 索引，例如 InnoDB，即每一个叶子节点都包含指向下一个叶子节点的指针，从而方便遍历叶子节点的范围）。</p><p>B-tree 通常意味着所有的值都是按顺序存储的，并且每一个叶子页到根的距离相同。</p><img src="https://figure-bed.chua-n.com/数据库/MySQL/18.jpg" style="zoom:20%;"><p>B-tree 是按照索引列中的数据大小顺序存储的，所以很适合按照范围来查询。例如，在一个基于文本列的索引树上遍历，按字母顺序传递连续的值进行范围查找是非常合适的，所以，像“找出所有以 I 到 K 开头的名字”这样的查找效率会非常高。</p><p>请注意，索引对多个值进行排序的依据是 <code>CREATE TABLE</code> 语句中定义索引时列的顺序。</p><p>InnoDB 存储引擎有一个被称为<em>自适应哈希索引</em>的特性：当 InnoDB 发现某些索引值被非常频繁地访问时，它会在原有的 B-tree 索引之上，在内存中再构建一个哈希索引。这就是 B-tree 索引也具备了一些哈希索引的优势，例如，可以实现非常快速的哈希查找。这个过程是完全自动化的，用户无法进行控制或者配置，不过，可以通过参数彻底关闭自适应哈希索引这个特性。</p><p>B-tree 索引适用于全键值、键值范围或键前缀查找，其中键前缀查找只适用于根据最左前缀的查找。细究而言，可以使用 B-tree 索引的查询类型：</p><ul><li>全值匹配：指和索引中的所有列匹配。</li><li>匹配最左前缀</li><li>匹配列前缀</li><li>匹配范围值</li><li>精确匹配某一列而范围匹配另一列</li><li>只访问索引的查询</li></ul><p>因为索引树中的节点是有序的，所以除了按值查找，索引还可以用于查询中的 <code>ORDER BY</code> 操作（按顺序查找）。</p><p>下面是一些关于 B-tree 索引的限制：</p><ul><li>如果不是按照索引的最左列开始查找，则无法使用索引；</li><li>不能跳过索引中的列；</li><li>如果查询中有某列的范围查询，则其右边所有列都无法使用索引优化查找。</li></ul><h4 id="_2-3-2-全文索引" tabindex="-1"><a class="header-anchor" href="#_2-3-2-全文索引"><span>2.3.2 全文索引</span></a></h4><p><code>FULLTEXT</code> 是一种特殊类型的索引，它查找的是文本中的关键词，而不是直接比较索引中的值。</p><p>全文索引和其他几类索引的匹配方式完全不一样，它有许多需要注意的细节，如停用词、词干、复数、布尔搜索等。全文索引更类似于搜索引擎做的事情，而不是简单的 <code>WHERE</code> 条件匹配。</p><h3 id="_2-4-高性能的索引策略" tabindex="-1"><a class="header-anchor" href="#_2-4-高性能的索引策略"><span>2.4 高性能的索引策略</span></a></h3><p>正确地创建和使用索引是实现高性能查询的基础。高效地选择和使用索引有很多种方式，其中有些是针对特殊案例的优化方法，有些则是针对特定行为的优化。</p><h4 id="_2-4-1-前缀索引和索引的选择性" tabindex="-1"><a class="header-anchor" href="#_2-4-1-前缀索引和索引的选择性"><span>2.4.1 前缀索引和索引的选择性</span></a></h4><p>有时候为了提升索引的性能，同时也节省索引空间，可以只对字段值的前一部分字符进行索引，这样做的缺点是会降低索引的选择性。</p><p><strong>索引的选择性</strong>是指，不重复的索引值（也称为基数，cardinality）和数据表的记录总数（<code>#T</code>）的比值，范围从 <code>1/#T</code> 到 <code>1</code> 之间。索引的选择性越高，则查询的效率越高。唯一索引的选择性是 1，这是最好的索引选择性，性能也是最好的。</p><p>一般情况下，列前缀的选择性也是足够高的，足以满足查询性能。对于 <code>BLOB, TEXT</code> 或者很长的 <code>VARCHAR</code> 类型的列，必须使用前缀索引，因为 MySQL 并不支持对这些列的完整内容进行索引。</p><p>前缀索引的创建：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> sakila</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">city_demo</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> ADD</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (city(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>前缀索引是一种能使索引更小、更快的有效办法，但它也有缺点：MySQL 无法使用前缀索引做 <code>ORDER BY</code> 和 <code>GROUP BY</code> 操作，也无法使用前缀索引做覆盖扫描。</p><h4 id="_2-4-2-多列索引" tabindex="-1"><a class="header-anchor" href="#_2-4-2-多列索引"><span>2.4.2 多列索引</span></a></h4><p>多列索引并不是为每列创建独立的索引，这在大部分情况下并不能提高 MySQL 的查询性能。MySQL 引入了一种叫“<strong>索引合并</strong>”（index merge）的策略，它在一定程度上可以使用表中的多个单列索引来定位指定的行，在这种情况下，查询能够同时使用两个单列索引进行扫描，并将结果进行合并。</p><p>索引合并有三个变种：</p><ul><li>OR 条件的联合</li><li>AND 条件的相交</li><li>OR 和 AND 的同时组合</li></ul><p>通过 <code>EXPLAIN</code> 中的 <code>Extra</code> 列可以看出索引合并的存在：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mysql</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXPLAIN </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> film_id, actor_id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> sakila</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">film_actor</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    -</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> actor_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> OR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> film_id </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\G</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">**************************** </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">. </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">row</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ***************************</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> select_type: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SIMPLE</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: film_actor</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> partitions: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NULL</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: index_merge</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> possible_keys: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">PRIMARY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,idx_fk_film_id</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">PRIMARY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,idx_fk_film_id</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> key_len: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ref: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NULL</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> rows</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">29</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> filtered: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Extra: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">Using</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> union</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">PRIMARY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,idx_fk_film_id); </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">Using</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> where</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然而，索引合并策略有时候效果非常不错，但更多的时候，它说明了表中的索引建得很糟糕。如果在 <code>EXPLAIN</code> 中看到有索引合并，那么就应该好好检查一下查询语句的写法和表的结构，看是不是已经是最优的。</p><p>回到多列索引本身，必须要清楚，多列索引的列顺序至关重要。对于如何选择索引的列顺序有一个重要的<em>经验法则：将选择性最高的列放到索引最前列</em>。</p><h4 id="_2-4-3-聚簇索引" tabindex="-1"><a class="header-anchor" href="#_2-4-3-聚簇索引"><span>2.4.3 聚簇索引</span></a></h4><p><strong>聚簇索引</strong>并不是一种单独的索引类型，而是一种数据存储方式。当表有聚簇索引时，它的数据行实际上放在索引的叶子页（leaf page）中，术语“聚簇”表示数据行和相邻的键值紧凑地存储在一起。因为无法同时把数据行存放在两个不同的地方，所以<em>一个表只能有一个聚簇索引</em>。</p><p>有些数据库服务器允许你选择用于聚簇的索引，但是 MySQL 内置的存储引擎都不支持这个特性。InnoDB 根据主键聚族索引。</p><p>聚簇索引有一些重要的优点：</p><ul><li>你可以把相互关联的数据保存在一起：如，在实现电子邮箱应用时，可以根据用户 ID 来聚集数据，这样只需要从磁盘读取少数的数据页就能获取某个用户的全部邮件。如果没有使用聚簇索引，则每封邮件都可以导致一次磁盘 I/O。</li><li>数据访问更快：聚簇索引将索引和数据保存在同一个 B-tree 中，因此从聚簇索引中获取数据通常比在非聚簇索引中查找要快。</li><li>使用覆盖索引扫描的查询可以直接使用页节点中的主键值。</li></ul><p>同时，聚簇索引也有一些缺点：</p><ul><li>聚簇数据最大限度地提高了 I/O 密集型应用的性能，但如果数据全部都放在内存中，则访问的顺序就没那么重要了，聚簇索引也就没什么优势了。</li><li>插入速度严重依赖于插入顺序：按照主键的顺序插入行是将数据加载到 InnoDB 表中最快的方式。但如果不是按照主键的顺序加载数据，那么在加载完成后最好使用 <code>OPTIMIZE TABLE</code> 命令重新组织一下表。</li><li>更新聚簇索引列的代价很高，因为它会强制 InnoDB 将每个被更新的行移动到新的位置。</li><li>基于聚簇索引的表在插入新行，或者主键被更新导致需要移动行的时候，可能面临<em>页分裂</em>（page split）的问题。当行的主键值要求必须将这一行插入某个已满的页中时，存储引擎会将该页分裂成两个页面来容纳该行，这就是一次页分裂操作。页分裂会导致表占用更多的磁盘空间。</li><li>聚簇索引可能导致全表扫描变慢，尤其是行比较稀疏，或者由于页分裂导致数据存储不连续的时候。</li><li>二级索引（非聚簇索引）可能比想象中的要更大，因为二级索引的叶子节点包含了引用行的主键列。</li><li>二级索引访问需要两次索引查找，而不是一次。</li></ul><h4 id="_2-4-4-覆盖索引" tabindex="-1"><a class="header-anchor" href="#_2-4-4-覆盖索引"><span>2.4.4 覆盖索引</span></a></h4><p>大家通常都会根据查询的 <code>WHERE</code> 条件来创建合适的索引，不过这只是索引优化的一个方面。设计优秀的索引应该考虑到整个查询，而不单是 <code>WHERE</code> 条件部分。索引的确是一种高效找到数据的方式，但是如果 MySQL 还可以使用索引直接获取列的数据，这样就不再需要读取数据行了。</p><p>如果一个索引包含（或者说覆盖）所有需要查询的字段的值，我们就称之为<strong>覆盖索引</strong>。需要注意的是，只有 B-tree 索引可以用于覆盖索引。</p><p>覆盖索引是非常有用的工具，这样的查询只需要扫描索引而无须回表，能够极大地提高性能。</p><p>当执行一个被索引覆盖的查询（也叫作索引覆盖查询）时，在 <code>EXPLAIN</code> 的 Extra 列可以看到<code>Using index</code>的信息。</p><p>例如，表 <code>sakila.inventory</code> 有一个多列索引（<code>store_id,film_id</code>），MySQL 如果只需要访问这两列，就可以使用这个索引做覆盖索引：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mysql</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> EXPLAIN </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> store_id, film_id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> sakila</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">inventory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\G</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">***************************** </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">. </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">row</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ***************************</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> select_type: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SIMPLE</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: inventory</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> partitions: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NULL</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">index</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> possible_keys: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NULL</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: idx_store_id_film_id</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> key_len: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ref: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NULL</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> rows</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4581</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> filtered: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">00</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Extra: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">Using</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> index</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-5-使用索引扫描来做排序" tabindex="-1"><a class="header-anchor" href="#_2-4-5-使用索引扫描来做排序"><span>2.4.5 使用索引扫描来做排序</span></a></h4><p>MySQL 有两种方式可以生成有序的结果：</p><ul><li>通过排序操作。</li><li>按索引顺序扫描：如果在 <code>EXPLAIN</code> 的输出结果中，<code>type</code> 列的值为 <code>index</code>，则说明 MySQL 使用了索引扫描来做排序（注意不要和 <code>Extra</code> 列的 <code>Using index</code> 搞混）。</li></ul><p>MySQL 可以使用同一个索引既满足排序，又用于查找行。因此，如果可能，设计索引时应该尽可能地同时满足这两项任务，这样是最好的。</p><p>只有当索引的顺序和 <code>ORDER BY</code> 字句的顺序完全一致，并且所有列的排序方向（倒序或正序）都一样时，MySQL 才能使用索引来对结果做排序。如果查询需要联接多张表，则只有当 <code>ORDER BY</code> 子句引用的字段全部在第一个表中时，才能使用索引做排序。<code>ORDER BY</code> 子句和查找型查询的限制是一样的：需要满足索引的最左前缀的要求，否则，MySQL 需要执行排序操作，而无法利用索引排序。</p><h4 id="_2-4-6-避免重复和冗余索引" tabindex="-1"><a class="header-anchor" href="#_2-4-6-避免重复和冗余索引"><span>2.4.6 避免重复和冗余索引</span></a></h4><p>不幸的是，MySQL 允许在相同列上创建多个相同的索引，虽然其会抛出一个警告，但它并不会阻止你这么做。</p><p>这里所言的<strong>重复索引</strong>是指在相同的列上按照相同顺序创建的相同类型的索引，应该避免创建这样的重复索引，发现以后应该立即移除。</p><ul><li><p>示例：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ID </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    A </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    B </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    UNIQUE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ID),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(ID)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) ENGINE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">InnoDB;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>说明：上述代码可以是想创建一个主要，先加上唯一限制，然后再加上索引以供查询使用。而事实上，MySQL 的唯一限制和主键限制都是通过索引实现的，因此，上述写法实际上在相同的列上合建了三个重复的索引。</p></li></ul><p>这里所言的<strong>冗余索引</strong>是指，如果创建了索引 <code>(A, B)</code>，再创建索引 <code>(A)</code> 就是冗余索引，因为这只是前一个索引的前缀索引。大部分情况下都不需要冗余索引，应该尽量扩展已有的索引而不是创建新的索引，但有时候出于性能方面的考虑也需要冗余索引，因为扩展已有的索引会导致其变得太大，从而影响其他使用该索引的查询的性能。</p><h3 id="_2-5-维护索引和表" tabindex="-1"><a class="header-anchor" href="#_2-5-维护索引和表"><span>2.5 维护索引和表</span></a></h3><p>找到并修复损坏的表：</p><ul><li>损坏的索引会导致查询返回错误的结果或者出现莫须有的主键冲突等问题。</li><li>可以使用 <code>REPAIR TABLE</code> 命令来修复损坏的表。但同样不是所有的存储引擎都支持该命令，如果存储引擎不支持，可通过一个不做任何操作的 <code>ALTER</code> 操作来重建表，例如，把表的存储引擎修改为当前的引擎 <code>ALTER TABLE &lt;table&gt; ENGINE=INNODB;</code></li></ul><p>更新索引统计信息：</p><ul><li><p>可以使用 <code>SHOW INDEX FROM</code> 命令来查看索引的基数（cardinality）：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">mysql</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> SHOW </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INDEX</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> sakila</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">actor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\G</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">**************************** </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">. </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">row</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ****************************</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> Table</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: actor</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Non_unique: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Key_name: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">PRIMARY</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Seq_in_index: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Column_name: actor_id</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Collation: A</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Cardinality: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">200</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Sub_part: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NULL</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Packed: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NULL</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> Null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Index_type: BTREE</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Comment:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">**************************** </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">. </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">row</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ****************************</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> Table</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: actor</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Non_unique: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Key_name: idx_actor_last_name</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Seq_in_index: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Column_name: last_name</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Collation: A</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Cardinality: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">200</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Sub_part: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NULL</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Packed: </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NULL</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> Null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Index_type: BTREE</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Comment:</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>减少索引和数据的碎片：</p><ul><li>B-tree 索引可能会产生碎片化，这会降低查询的效率。</li><li>表的数据存储也可能分生碎片化，有三种类型的数据碎片： <ul><li>行碎片（Row fragmentation）：指数据行被存储在多个地方的多个片段中。即使查询只从索引中访问一行记录，行碎片也会导致性能下降。</li><li>行间碎片（Intra-row fragmentation）：指逻辑上顺序的页或者行，在磁盘上不是顺序存储的。行间碎片对诸如全表索和聚簇索引扫描之类的操作有很大的影响，因为这些操作原本能够从磁盘上顺序存储的数据中获益。</li><li>剩余空间碎片（Free space fragmentation）：指数据页中有大量的空余空间。这会导致服务器读取大量不需要的数据，从而造成浪费。</li></ul></li></ul><h3 id="_2-6-唯一性索引-vs-唯一性约束" tabindex="-1"><a class="header-anchor" href="#_2-6-唯一性索引-vs-唯一性约束"><span>2.6 唯一性索引 vs 唯一性约束</span></a></h3><blockquote><p>某一列是索引，但并不意味着该列的值是不能重复的。</p></blockquote><p>在设计关系数据表的时候，看上去唯一的列，例如身份证号、邮箱地址等，因为他们具有业务含义，因此不宜作为主键。但是，这些列根据业务要求，又具有唯一性约束：即不能出现两条记录存储了同一个身份证号。这个时候，就可以给该列添加一个唯一索引。</p><p>例如，我们假设<code>students</code>表的<code>name</code>不能重复，通过下面的<code>UNIQUE</code>关键字我们就添加了一个唯一索引：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> students</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ADD</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> UNIQUE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> uni_name (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以只对某一列添加一个唯一约束而不创建唯一索引，下面这种情况，<code>name</code>列没有索引，但仍然具有唯一性保证。</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> students</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">ADD</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> CONSTRAINT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> uni_name </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">UNIQUE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-约束" tabindex="-1"><a class="header-anchor" href="#_3-约束"><span>3. 约束</span></a></h2><p>一张表中的主键一定是唯一的，但约束可以有多个。</p><p>约束：</p><ul><li><code>Default</code>约束</li><li><code>Check</code>约束</li><li><code>Unique</code>约束</li></ul></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/chua-n/chua-n.github.io/edit/main/book/数据库/MySQL/索引.md" aria-label="编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><span class="vp-meta-info" data-allow-mismatch="text">2024/5/6 10:03:53</span></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: chua_n@yeah.net">chua-n</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/SQL%E8%AF%AD%E8%A8%80.html" aria-label="SQL语言"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><span class="font-icon icon iconfont icon-markdown-black" style=""></span>SQL语言</div></a><a class="route-link auto-link next" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E4%BA%8B%E5%8A%A1.html" aria-label="事务"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">事务<span class="font-icon icon iconfont icon-markdown-black" style=""></span></div></a></nav><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">应无所住，而生其心</div><div class="vp-copyright">Copyright © 2024 荒流 </div></footer></div><!--]--><!--[--><!----><div id="pwa-install"><!----><div id="install-modal-wrapper" style="display:none;"><div class="background"></div><div class="install-modal"><div class="header"><button type="button" class="close-button" aria-label="关闭"><svg xmlns="http://www.w3.org/2000/svg" class="icon close-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="close icon"><path d="M589.654 511.965 1007.212 84.22a49.777 49.777 0 0 0-.73-70.02 49.046 49.046 0 0 0-69.687.665L519.967 441.946 85.882 14.2a49.08 49.08 0 0 0-69.687.664 49.777 49.777 0 0 0 .664 70.019l433.454 427.082L16.859 939.048a49.777 49.777 0 0 0-.664 70.019 49.013 49.013 0 0 0 69.687.663l434.085-427.746 416.828 427.083A49.013 49.013 0 0 0 972.037 1024a48.416 48.416 0 0 0 34.512-14.27 49.777 49.777 0 0 0 .73-70.019z"></path></svg></button><div class="logo"><!----><div class="title"><h1></h1><p class="desc">该应用可以安装在你的 PC 或移动设备上。这将使该 Web 应用程序外观和行为与其他应用程序相同。它将在出现在应用程序列表中，并可以固定到主屏幕，开始菜单或任务栏。此 Web 应用程序还将能够与其他应用程序和你的操作系统安全地进行交互。</p></div></div></div><div class="content"><div class="highlight"><!----><!----></div><div class="description"><h3>详情</h3><p></p></div></div><div class="button-wrapper"><button type="button" class="install-button">安装<span></span></button><button type="button" class="cancel-button">取消</button></div></div></div></div><!----><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.59330dc2.js" defer></script><script src="/assets/js/48912.3c1ac731.js" defer></script><script src="/assets/js/app.906eea05.js" defer></script>
  </body>
</html>
