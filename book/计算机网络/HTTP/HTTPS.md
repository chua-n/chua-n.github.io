---
title: HTTPS
date: 2022-10-11
---

## 1. HTTP 的不足与应对策略

### 1.1 不足

HTTP 主要有这些不足，例举如下：

> 这些问题不仅在 HTTP 上出现，其他未加密的协议中也会存在这类问题。

- HTTP 通信使用明文（不加密），内容可能会被窃听——TCP/IP 是可能被窃听的网络，互联网上的任何角落都存在通信内容被窃听的风险：

  > 窃听相同段上的通信并非难事。只需要收集在互联网上流动的数据包（帧）就行了。对于收集来的数据包的解析工作，可交给那些抓包（Packet Capture）或嗅探器（Sniffer）工具。

  ![image-20221011171033531](https://figure-bed.chua-n.com/杂技/计算机网络/image-20221011171033531.png)

- HTTP 不验证通信方的身份，因此有可能遭遇伪装——存在“服务器是否就是发送请求中 URI 真正指定的主机，返回的响应是否真的返回到实际提出请求的客户端”等类似问题：

  - 任何人都可发起请求：

    ![image-20221011171918383](https://figure-bed.chua-n.com/杂技/计算机网络/image-20221011171918383.png)

  - 类似地，无法确定请求发送至目标的 Web 服务器是否是按真实意图返回响应的那台服务器，有可能是已伪装的 Web 服务器。

  - 即使是无意义的请求也会照单全收。无法阻止海量请求下的 DoS 攻击（Denial of Service，拒绝服务攻击）。

- 无法证明报文的完整性，所以有可能已遭篡改——由于 HTTP 协议无法证明通信的报文完整性，因此，在请求或响应送出之后直到对方接收之前的这段时间内，即使请求或响应的内容遭到篡改，也没有办法获悉：

  ![image-20221011172626008](https://figure-bed.chua-n.com/杂技/计算机网络/image-20221011172626008.png)

  > 这里所谓完整性是指信息的准确度。淦，那为什么不直接使用准确性这一术语呢？？？
  >
  > 像这样，请求或响应在传输途中，遭攻击者拦截并篡改内容的攻击称为中间人攻击（Man-in-the-Middle attack，MITM）：
  >
  > ![image-20221011172725360](https://figure-bed.chua-n.com/杂技/计算机网络/image-20221011172725360.png)

### 1.2 应对策略之加密

以加密的目标对象来划分，加密可分为加密通信方式和加密通信内容两种：

- 加密通信方式：HTTP 协议中没有加密机制，但可以通过和 SSL（Secure Socket Layer，安全套接层）或 TLS（Transport Layer Security，安全层传输协议）的组合使用，加密 HTTP 的通信内容。

  ![image-20221011171329023](https://figure-bed.chua-n.com/杂技/计算机网络/image-20221011171329023.png)

- 加密通信内容：还有一种将参与通信的内容本身加密的方式，即把 HTTP 报文里所含的内容进行加密处理。但是，这种方式不同于 SSL 或 TLS 将整个通信线路加密处理，所以内容仍有被篡改的风险。

  ![image-20221011171415678](https://figure-bed.chua-n.com/杂技/计算机网络/image-20221011171415678.png)

### 1.3 应对策略之通信方身份的认证

虽然使用 HTTP 协议无法确定通信方，但如果使用 SSL 则可以。SSL 不仅提供加密处理，而且还使用了一种被称为证书的手段，可用于确定方。

证书由值得信任的第三方机构颁发，用以证明服务器和客户端是实际存在的。另外，伪造证书从技术角度来说是异常困难的一件事。所以只要能够确认通信方（服务器或客户端）持有的证书，即可判断通信方的真实意图。

![image-20221011172300412](https://figure-bed.chua-n.com/杂技/计算机网络/image-20221011172300412.png)

通过使用证书，以证明通信方就是意料中的服务器。这对使用者个人来讲，也减少了个人信息泄露的危险性。

另外，客户端持有证书即可完成个人身份的确认，也可用于对 Web 网站的认证环节。

### 1.4 应对策略之完整性保护

虽然有使用 HTTP 协议确定报文完整性的方法，但事实上并不便捷、可靠。其中常用的是 MD5 和 SHA-1 等散列值校验的方法，以及用来确认文件的数字签名方法。

提供文件下载服务的 Web 网站也会提供相应的以 PGP（Pretty Good Privacy，完美隐私）创建的数字签名及 MD5 算法生成的散列值。PGP 是用来证明创建文件的数字签名，MD5 是由单向函数生成的散列值。不论使用哪一种方法，都需要操纵客户端的用户本人亲自检查验证下载的文件是否就是原来服务器上的文件，浏览器无法自动帮用户检查。然而，即便如此，用这些方法也依然无法百分百保证确认结果正确。因为 PGP 和 MD5 本身被改写的话，用户是没有办法意识到的。

## 2. HTTPS 协议的诞生

$$
HTTPS = HTTP + 加密 + 认证 + 完整性保护
$$

为了统一解决上述这些问题，需要在 HTTP 上再加入加密处理和认证等机制。我们把添加了加密及认证机制的 HTTP 称为 HTTPS（HTTP Secure）。

![image-20221011173848565](https://figure-bed.chua-n.com/杂技/计算机网络/image-20221011173848565.png)

### HTTPS 是身披 SSL 外壳的 HTTP

HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用 SSL 或 TLS 协议代替而已。

通常，HTTP 直接和 TCP 通信。当使用 SSL 时，则演变成先和 SSL 通信，再由 SSL 和 TCP 通信了。简言之，所谓 HTTPS，其实就是身披 SSL 协议这层外壳的 HTTP：

![image-20221011174346307](https://figure-bed.chua-n.com/杂技/计算机网络/image-20221011174346307.png)

在采用 SSL 后，HTTP 就拥有了 HTTPS 的加密、证书和完整性保护这些功能。

> SSL 是独立于 HTTP 的协议，所以不光是 HTTP 协议，其他运行在应用层的 SMTP 和 Telnet 等协议均可配合 SSL 协议使用。可以说 SSL 是当今世界上应用最为广泛的网络安全技术。

## 3. 加密技术

HTTPS 采用*共享密钥加密*（对称密钥加密）和*公开密钥加密*（非对称密钥加密中的公开密钥）两者并用的混合加密机制。

若密钥能够实现安全交换，那么有可能会考虑仅使用公开密钥加密来通信。但是公开密钥加密与共享密钥加密相比，其处理速度要慢。所以应充分利用两者各自的优势，将多种方法组合起来用于通信。在交换密钥环节使用公开密钥加密方式，之后的建立通信交换报文阶段则使用共享密钥加密方式。

![image-20221011211411788](https://figure-bed.chua-n.com/杂技/计算机网络/image-20221011211411788.png)

## 4. 证明公开密钥正确性的证书

遗憾的是，公开密钥加密方式还是存在一些问题的，那就是无法证明公开密钥本身就是货真价实的公开密钥。

### 4.1 确认服务端的服务器端证书

比如，正准备和某台服务器建立公开密钥加密方式下的通信时，如何证明收到的公开密钥就是原本预想的那台服务器发行的公开密钥。或许在公开密钥传输途中，真正的公开密钥已经被攻击者替换掉了。

为了解决上述问题，可以使用由*数字证书认证机构*（CA，Certificate Authority）和其相关机关颁发的公开密钥证书。数字证书认证机构处于客户端与服务器双方都可信赖的第三方机构的立场上。

![image-20221011212102392](https://figure-bed.chua-n.com/杂技/计算机网络/image-20221011212102392.png)

### 4.2 确认客户端的客户端证书

HTTPS 中还可以使用客户端证书。以客户端证书进行客户端认证，证明服务器正在通信的对方始终是预料之内的客户端，其作用跟服务器证书如出一辙。

但客户端证书仍存在几处问题点。其中的一个问题点是证书的获取及发布。

想获取证书时，用户得自行安装客户端证书。但由于客户端证书是要付费购买的，且每张证书对应到每位用户也就意味着需支付和用户数对等的费用。另外，要让知识层次不同的用户们自行安装证书，这件事本身也充满了各种挑战。

现状是，安全性极高的认证机构可颁发客户端证书但仅用于特殊用途的业务。比如那些可支撑客户端证书支出费用的业务。例如，银行的网上银行就采用了客户端证书。在登录网银时不仅要求用户确认输入 ID 和密码，还会要求用户的客户端证书，以确认用户是否从特定的终端访问网银。

客户端证书存在的另一个问题点是，客户端证书毕竟只能用来证明客户端实际存在，而不能用来证明用户本人的真实有效性。也就是说，只要获得了安装有客户端证书的计算机的使用权限，也就意味着同时拥有了客户端证书的使用权限。

## 5. HTTPS 的安全通信机制

下图中说明了从仅使用服务器端的公开密钥证书（服务器证书）建立 HTTPS 通信的整个过程：

![image-20221011213320111](https://figure-bed.chua-n.com/杂技/计算机网络/image-20221011213001531.png)

## 6. HTTPS 的缺点

HTTPS 也存在一些问题，那就是由于使用了 SSL，它的处理速度变慢了。

SSL 的慢分两种：

- 通信慢：和使用 HTTP 相比，网络负载可能会变慢 2 到 100 倍。除去和 TCP 连接、发送 HTTP 请求 • 响应以外，还必须进行 SSL 通信，因此整体上处理通信量不可避免会增加。
- 处理速度慢：SSL 必须进行加密处理。在服务器和客户端都需要进行加密和解密的运算处理。因此从结果上讲，比起 HTTP 会更多地消耗服务器和客户端的硬件资源，导致负载增强。

针对速度变慢这一问题，并没有根本性的解决方案，我们会使用 SSL 加速器这种（专用服务器）硬件来改善该问题。该硬件为 SSL 通信专用硬件，相对软件来讲，能够提高数倍 SSL 的计算速度。仅在 SSL 处理时发挥 SSL 加速器的功效，以分担负载。