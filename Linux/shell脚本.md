## 1. shell 基操

Shell 终端解释器作为用户与 LINUX 系统内部的通信媒介，除了支持各种变量与参数外，还提供了诸如循环、分支等高级编程语言才有的控制结构特性。

Shell 命令的工作方式有两种：

1. 交互式(Interactive)——用户每输入一条命令就立即执行；

2. 批处理(Batch)——由用户事先编写好一个完整的 SHELL 脚本，SHELL 会一次性执行脚本中诸多的命令。

Shell 脚本文件的名称可以任意，但为了避免被误以为是普通文件，最好将.sh 后缀加上，以表示是一个脚本文件。以下为一个简单的脚本编写内容，其中第一行的脚本声明（#!）用来告诉系统使用哪种 SHELL 解释器来执行该脚本，第二行的注释信息（#）是对脚本功能和某些命令的介绍信息，第三、四行的可执行语句也就是我们平时执行的 Linux 命令了。

| 脚本内容                                                | 执行脚本                                                |
| ------------------------------------------------------- | ------------------------------------------------------- |
| ![](https://chua-n.gitee.io/figure-bed/notebook/杂技/Linux/31.png) | ![](https://chua-n.gitee.io/figure-bed/notebook/杂技/Linux/32.png) |

执行脚本可用`bash <example.sh>`或输入完整路径`./example.sh`，不过后一种默认会因权限不足而提示错误，此时只要为脚本文件增加执行权限即可。

SHELL 脚本中的条件测试语法可以判断表达式是否成立，若条件成立则返回数字 0，否则返回其他随机数值。切记，**条件表达式**两边均应有一个空格。

![](https://chua-n.gitee.io/figure-bed/notebook/杂技/Linux/33.png)

按照测试对象来划分，条件测试语句可分为文件测试、逻辑测试、整数值比较、字符串比较语句。其中，文件测试所用的参数为：

| 运算符 |            作用            |
| :----: | :------------------------: |
|   -d   |   测试文件是否为目录类型   |
|   -e   |      测试文件是否存在      |
|   -f   |     判断是否为一般文件     |
|   -r   | 测试当前用户是否有权限读取 |
|   -w   | 测试当前用户是否有权限写入 |
|   -x   | 测试当前用户是否有权限执行 |

用 `echo $?` 可显示`$?`变量的值，`$?`是 SHELL 解释器内置的表示上一条命令执行后的返回值的变量。

一些运算符：

| 逻辑符 | 符号 |    整数比较    | 符号 |       字符串比较       | 符号 |
| :----: | :--: | :------------: | :--: | :--------------------: | :--: |
|   与   |  &&  |    是否等于    | -eq  | 比较字符串内容是否相同 |  =   |
|   或   | \|\| |   是否不等于   | -ne  | 比较字符串内容是否不同 |  !=  |
|   非   |  !   |    是否大于    | -gt  | 判断字符串内容是否为空 |  -z  |
|        |      |    是否大于    | -lt  |                        |      |
|        |      | 是否等于或小于 | -le  |                        |      |
|        |      | 是否大于或等于 | -ge  |                        |      |

## 2. shell 字符串

字符串可以用单引号和双引号，也可以不用引号。

-   单引号：`str='this is a string'`，单引号里的任何字符都会原样输出，也就是说单引号字符串中的变量是无效的；

-   双引号：

    ```bash
    $ your_name='runoob'
    $ str="Hello, I know you are \"$your_name\"! \n"
    $ echo -e $str
    Hello, I know you are "runoob"!
    ```

    -   双引号里可以有变量
    -   双引号里可以出现转义字符

不被引号包围的字符串：

1. 不被引号包围的字符串中出现变量时也会被解析，这一点和双引号" "包围的字符串一样；
2. 字符串中不能出现空格，否则空格后边的内容会被解析为其他变量或命令。

多个字符串直接放在一起时表示字符串拼接（类似 python 的语法）:

```bash
your_name="runoob"
# 使用双引号拼接
greeting="hello, "$your_name" !"
greeting_1="hello, ${your_name} !"
echo $greeting  $greeting_1
# 使用单引号拼接
greeting_2='hello, '$your_name' !'
greeting_3='hello, ${your_name} !'
echo $greeting_2  $greeting_3
```

```text
hello, runoob ! hello, runoob !
hello, runoob ! hello, ${your_name} !
```

获取字符串长度：

```bash
string="abcd"
echo ${#string} # 输出 4
```

## 3. 流程控制语句

-   if 语句

    -   单分支

        ```shell
        if 条件测试操作
          then 命令序列
        fi
        ```

    -   双分支

        ```shell
        if 条件测试操作
          then 命令序列1
          else 命令序列2
        fi
        ```

    -   多分支

        ```shell
        if 条件测试操作1
          then 命令序列1
        elif 条件测试操作2
          else 命令序列2
        else
          命令序列3
        fi
        ```

-   for 条件循环

    ```shell
    for 变量名 in 取值列表
    do
      命令序列
    done
    ```

-   while 条件循环

    ```shell
    while 条件测试操作
    do
      命令序列
    done
    ```

-   case 条件测试语句

    ```shell
    case 变量值 in
    模式1)
      命令序列1
      ;;
    模式2)
      命令序列2
      ;;
      ......
    *)
      默认命令序列
    esac
    ```

## 4. 计划任务

计划任务分为**一次性计划任务**与**长期性计划任务**

1. 一次性：今晚 11 点 30 分开启网站服务

2. 长期性：每周一的凌晨 3 点 25 分把/home/wwwroot 目录打包备份为 backup.tar.gz

at 命令与 crond 服务：

|    命令    |                作用                |     用户      |
| :--------: | :--------------------------------: | :-----------: |
|     at     |         设置一次性计划任务         |    at 时间    |
|   at -l    | 查看已设置好但还未执行的一次性任务 |               |
|    atrm    |        删除某一次性计划任务        | atrm 任务序号 |
| crontab -e |       创建、编辑长期计划任务       |               |
| crontab -l |          删除某条计划任务          |               |

部署计划任务的时间格式为“分、时、日、月、星期 命令”，若某些字段没有设置，使用星号`*`占位：

<img src="https://chua-n.gitee.io/figure-bed/notebook/杂技/Linux/34.png" style="zoom:50%;" />

计划任务中的“分”字段必须有数值，绝对不能为空或为\*号，而“日”和“星期”字段不能同时使用，否则就会发生冲突。
