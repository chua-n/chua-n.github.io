## 1. SpringMVC的数据响应方式

1. 页面跳转
    - 直接返回字符串；
    - 通过ModelAndView对象返回。
2. 回写数据
    - 直接返回字符串；
    - 返回对象或集合。

## 2. 页面跳转

### 2.1 返回字符串形式

此种方式会将返回的字符串与视图解析器的前后缀拼接后跳转。

![32](https://chua-n.gitee.io/blog-images/notebooks/JavaWeb/SpringMVC/32.png)

### 2.2 返回ModelAndView对象

Model为模型，作用为封装数据；View为视图，作用为展示数据。

```java
package com.itheima.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.ModelAndView;
import javax.servlet.http.HttpServletRequest;

@Controller
public class UserController {
    
    @RequestMapping("/quick")
    public String save() {
        System.out.println("Controller save running...");
        return "success.jsp";
    }
    
    @RequestMapping("/quick2")
    public ModelAndView save2() {
        ModelAndView modelAndView = new ModelAndView();
        // 设置模数数据：向域中放入数据
        modelAndView.addObject("username", "itcast");
        // 设置视图名称
        modelAndView.setViewName("success.jsp");
        return modelAndView;
    }
    
    /**
     * SpringMVC在解析方法时，如果发现方法的参数有ModelAndView,Model,HttpServletRequest等
     * 常用类型的形参时，那么SpringMVC就可以自动帮你对相应的参数进行注入
     */
    @RequestMapping("/quick3")
    public ModelAndView save3(ModelAndView modelAndView) {
        // 设置模数数据：向域中放入数据
        modelAndView.addObject("username", "itheima");
        // 设置视图名称
        modelAndView.setViewName("success.jsp");
        return modelAndView;
    }
    
    @RequestMapping("/quick4")
    public String save4(Model model) {
        // 向域中放入数据
        model.addAttribute("username", "博学谷");
        return "success.jsp";
    }
    
    // 不常用，应该尽量调用框架提供的对象，放这里只是说明这样也可以
    @RequestMapping("/quick5")
    public String save5(HttpServletRequest request) {
        // 向域中放入数据
        request.setAttribute("username", "酷丁鱼");
        return "success.jsp";
    }
}
```

## 3. 回写数据

### 3.1 直接返回字符串

Web基础阶段，客户端访问服务器端，如果想直接写回字符串作为响应体返回的话，只需要使用`response.getWriter().print("hello world")`即可，那么在SpringMVC的Controller中如何写回字符串呢？

1. 方案一（不推荐）：通过SpringMVC框架注入的`response`对象，使用`response.getWriter().print("hello world")`回写数据，此时不需要视图跳转，业务方法返回值为void。

    ```java
    @RequestMapping("/quick6")
    public void save6(HttpServletResponse response) throws IOException {
        // 回写数据
        response.getWriter().print("hello itcast");
    }
    ```

    ![33](https://chua-n.gitee.io/blog-images/notebooks/JavaWeb/SpringMVC/33.png)

2. 方案二：将需要回写的字符串直接返回，但此时需要通过`@ResponseBody`注解告知SpringMVC框架，方法返回的字符串不是跳转而是直接在http响应体中返回。

    ```java
    @RequestMapping("/quick7")
    // 形式上与/quick1相似，故而为防歧义，加@ResponseBody注解
    // 告诉SpringMVC框架，不进行数据跳转，直接进行数据响应
    @ResponseBody
    public String save7() {
        return "hello itheima";
    }
    ```

    ![34](https://chua-n.gitee.io/blog-images/notebooks/JavaWeb/SpringMVC/34.png)

### 3.2 返回对象或集合

通过SpringMVC帮助我们将对象/集合进行json字符串的转换并回写。

> **注意相应的对象必须同时实现get和set方法！**

-  前提：对于一个User类，希望将其以json格式字符串进行回写：

    ```java
    // User.java
    package com.itheima.domain;
    
    public class User {
        private String username;
        private int age;
        public void setUsername(String username) {
            this.username = username;
        }
        public void setAge(int age) {
            this.age = age;
        }
        public String getUsername() {
            return username;
        }
        public int getAge() {
            return age;
        }
        @Override
        public String toString() {
            return "User{" +
                    "username='" + username + '\'' +
                    ", age=" + age +
                    '}';
        }
    }
    ```

    ```java
    // UserController.java
    
    @RequestMapping("/quick8")
    @ResponseBody // 不可省略
    // 期望SpringMVC自动将User转换成json格式的字符串
    public User save8() {
        User user = new User();
        user.setUsername("zhangsan");
        user.setAge(27);
        return user;
    }
    ```

- 需要导入jackson（json解析器）相关依赖：

    ```xml
    <!--  导入json解析包  -->
    <dependency>
        <groupId>com.fasterxml.jackson.core</groupId>
        <artifactId>jackson-core</artifactId>
        <version>2.9.0</version>
    </dependency>
    <dependency>
        <groupId>com.fasterxml.jackson.core</groupId>
        <artifactId>jackson-databind</artifactId>
        <version>2.9.0</version>
    </dependency>
    <dependency>
        <groupId>com.fasterxml.jackson.core</groupId>
        <artifactId>jackson-annotations</artifactId>
        <version>2.9.0</version>
    </dependency>
    ```

- 解决方案

    - 方案1（不推荐）：在spring-mvc.xml中进行这些配置，为处理器适配器配置消息转换参数，指定使用jackson进行对象或集合的转换。

        ```xml
        <!--  配置处理器映射器  -->
        <bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter">
            <property name="messageConverters">
                <list>
                    <bean class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter"/>
                </list>
            </property>
        </bean>
        ```

    - 方案2（推荐）：在方法上添加@ResponseBody就可以返回json格式的字符串，可以使用mvc的“注解驱动”代替上述配置，简单便捷。

        ```xml
        <!--配置mvc的注解驱动-->
        <mvc:annotation-driven/>
        ```

- 方案2的解释：在SpringMVC的各个组件中，**处理器映射器**、**处理器适配器**、**视图解析器**称为SpringMVC的三大组件。配置了`<mvc:annotation-driven/>`语句后，就能够自动加载`RequestMappingHandlerMapping`（处理器映射器）和`RequestMappingHandlerAdapter`（处理器适配器），同时还会在底层默认集成jackson进行对象或集合的json格式字符串的转换。故而，可在spring-mvc.xml配置文件中使用`<mvc:annotation-driven/>`替代注解处理器和适配器的配置。

