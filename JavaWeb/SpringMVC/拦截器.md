## 1. 简介

**拦截器（interceptor）**的作用：SpringMVC的拦截器类似于Servlet开发中的过滤器Filter，用于对处理器进行**预处理**和**后处理**。

将拦截器按一定的顺序联结成一条链，即成为**拦截器链**（Interceptor Chain）。在访问被拦截的方法或字段时，拦截器链中的拦截器就会按其之前定义的顺序被调用。

拦截器也是AOP思想的具体实现。

拦截器与过滤器的区别：

| 区别     | 过滤器                                                  | 拦截器                                                       |
| -------- | ------------------------------------------------------- | ------------------------------------------------------------ |
| 使用范围 | 是Servlet规范中的一部分，任何Java Web工程都可以使用     | 是SpringMVC框架自己的，只有使用了SpringMVC框架的工程才能用   |
| 拦截范围 | 在url-pattern中配置了/*之后，可以对所有要访问的资源拦截 | 只会拦截访问的控制器方法，如果访问的是jsp、html、css、image、js，是不会进行拦截的 |

## 2. 使用拦截器

1. 创建拦截器类，实现HandlerInterceptor接口:

    ```java
    package com.itheima.interceptor;
    import org.springframework.web.servlet.HandlerInterceptor;
    import org.springframework.web.servlet.ModelAndView;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;
    public class MyInterceptor implements HandlerInterceptor {
        /**
         * 在目标方法执行之前执行
         *
         * @return // 返回true代表放行，返回false代表拦截
         * @throws Exception
         */
        @Override
        public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)
                throws Exception {
            System.out.println("preHandle.......");
            return false;
        }
        // 在目标方法执行之后、视图对象返回之前执行
        @Override
        public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler,
                ModelAndView modelAndView) throws Exception {
            System.out.println("postHandle......");
        }
        // 在流程都执行完毕后执行
        @Override
        public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)
                throws Exception {
            System.out.println("afterCompletion......");
        }
    }
    ```

2. 配置拦截器：spring-mvc.xml

    ```xml
    <!--  配置拦截器  -->
    <mvc:interceptors>
        <mvc:interceptor>
            <!--  对哪些资源执行拦截操作，这里设置全部  -->
            <mvc:mapping path="/*"/>
            <bean class="com.itheima.interceptor.MyInterceptor"/>
        </mvc:interceptor>
    </mvc:interceptors>
    ```

3. 测试

    - 令preHandle返回false时：

        | 浏览器                                 | 控制台输出       |
        | -------------------------------------- | ---------------- |
        | localhost/target<br />web页面显示：` ` | preHandle....... |

    - 令preHandle返回true时：

        | 浏览器                                                  | 控制台输出                                                   |
        | ------------------------------------------------------- | ------------------------------------------------------------ |
        | localhost/target<br />web页面显示：`Hello World!itcast` | preHandle.......<br />目标资源执行......<br />postHandle......<br />afterCompletion...... |

---

当拥有多个拦截器时，其按照在spring-mvc.xml配置文件中出现的顺序先后执行，参照过滤器Filter。 

## 3. 拦截器方法说明

| 方法              | 说明                                                         |
| :---------------- | ------------------------------------------------------------ |
| preHandle()       | 此方法在请求处理之前进行调用，其返回值为Boolean类型。当其返回false，表示请求结束，后续的Interceptor和Controller都不会再执行；当返回true，则会调用下一个Interceptor的preHandle()方法。 |
| postHandle()      | 此方法在当前请求进行处理之后、DispatcherServlet进行视图返回渲染之前被调用，前提是preHandle()方法的返回值为true。此方法可用于对Controller处理之后的ModelAndView对象进行操作。 |
| afterCompletion() | 此方法在整个请求结束之后（也就是在DispatcherServlet渲染了对应的视图之后）执行，前提也是preHandle()方法的返回值为true。 |

