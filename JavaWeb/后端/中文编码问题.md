## 1. 何谓编码？

需要编码的原因可以总结为以下几条：

1. 在计算机中存储信息的最小单元是1个字节，即8个bit，所以能表示的字符范围是0~255个；

2. 人类要表示的符号太多，无法用1个字节来完全表示。

要解决这个矛盾必须要有一个新的数据结构char，而从char到byte必须编码。

主要的几种编码格式：

1. ASCII码
2. ISO-8859-1
3. GB2312：《信息技术-中文编码字符集》，双字节编码
4. GBK：《汉字内码扩展规范》，扩展了GB2312
5. GB18030：《信息技术-中文编码字符集》，兼容GB2312，应用不广泛
6. UTF-16/UTF-8：说到UTF必须提到Unicode(Universal Code)。
    - UTF-16用两个字节来表示Unicode的转化格式，它采用定长的表示方式；
    - UTF-8采用了一种变长技术，每个编码区域有不同的字码长度，不同类型的字符可以由1~6个字节组成。UTF-8有以下编码规则：
        - 如果是1个字节，最高位（第8位）为0，则表示这是1个ASCII字符（00~7F）。可见，所有ASCII编码已经是UTF-8了。
        - 如果是1个字节，以11开头，则连接的1的个数暗示这个字符的字节数，例如：110xxxxx代表它是双字节UTF-8字符的首字节。
        - 如果是1个字节，以10开头，表示它不是首字节，则需要向前查找才能得到当前字符的首字节。

对几种编码格式的比较——

1. 将GB2312与GBK进行比较，应该选择GBK；

2. UTF-16的编码效率较高，从字符到字节的相互转换更简单，进行字符串操作也更好，其适合在本地磁盘和内存之间使用，可以进行字符和字节之间的快速切换，如Java的内存编码就采用UTF-16编码；

3. 但UTF-16不适合在网络之间传输，因为网络传输容易损坏字节流，一旦字节流损坏将很难恢复，所以UTF-8更适合网络传输；

4. UTF-8对ASCII字符采用单字节存储，另外单个字符损坏也不会影响后面的其他字符，在编码效率上介于GBK和UTF-16，所以UTF-8在编码效率上和编码安全性上做了平衡，是理想的中文编码方式。

## 2. Java编码

强烈建议不使用操作系统的默认编码，因为这样会使你的应用程序的编码格式和运行环境绑定，在跨环境时很可能出现乱码问题。

用户从浏览器发起一个HTTP请求，需要存在编码的地方是URL、Cookie、Paramiter。服务器端接收到HTTP请求后要解析HTTP，其中URI、Cookie和POST表单参数需要解码，服务器端可能还需要读取数据库中的数据——本地或网络中其他地方的文本文件，这些数据都可能存在编码问题。当Servlet处理完所有请求的数据后，需要将这些数据再编码，通过Socket发送到用户请求的浏览器时，再经过游览器解码成为文本。

<img src="https://chua-n.gitee.io/figure-bed/notebook/JavaWeb/后端/19.png" style="zoom:50%;" />

浏览器编码URL是将非ASCII字符按照某种编码格式编码成16进制数字，然后将每个16进制表示的字节前加上百分号%。

